loop = false #for inf loop

#storage
playerscores = {
  James: 255,
  Matthew: 745,
  Rachel: 102,
  Alix: 427,
  Tim: 1
}

#methods

def rankcalc(score)
  rankboundary = 249
  rank = 0
  while score > rankboundary
    rankboundary += 250
    rank += 1
  end
  return rank
end
def pointschange(winner,loser)
  x = 15 + (loser - winner) * 2
  if x > 25
    x = 25
    puts "Overscore Clause - points change capped at 25"
  elsif x < 5
    x = 5
    puts "Underscore clause - points change capped at 5"
  end
  return x
end

#frontend

while loop != true

  puts "What would you like to do?"
  puts "-- 'display' - "
  puts "-- 'battle' - "
  puts "-- 'add' - "
  puts "-- 'delete' - "
  puts "-- 'update' - "
  choice = gets.chomp.downcase

  case choice
    when "display"
      playerscores.each { |player,score| 
        puts "#{player}: #{score}"
      }

    when "battle"
      puts "Who won the battle?"
      winner = gets.chomp.capitalize

      if playerscores[winner.to_sym].nil?
        puts "Player not found!"
        next
      else
        winnerrank = rankcalc(playerscores[winner.to_sym])
      end

      puts "Who lost the battle?"
      loser = gets.chomp.capitalize
      if playerscores[loser.to_sym].nil?
        puts "Player not found!"
        next
      else
        loserrank = rankcalc(playerscores[loser.to_sym])
      end

      puts "-----------------"
      change = pointschange(winnerrank,loserrank)
      puts "#{winner}'s rank is #{winnerrank}, and #{loser}'s rank is #{loserrank}, therefore:"

      playerscores[winner.to_sym] += change
      playerscores[loser.to_sym] -= change

      puts "#{winner} gained #{change} points, and #{loser} lost #{change} points."

      if playerscores[loser.to_sym] < 0
        playerscores[loser.to_sym] = 0
        puts "#{loser}'s points became negative, so were reset to 0."
      end

      newwinnerrank = rankcalc(playerscores[winner.to_sym])
      newloserrank = rankcalc(playerscores[loser.to_sym])

      if newwinnerrank > winnerrank
        puts "#{winner}'s rank increased to #{newwinnerrank}."
      end
      if newloserrank < loserrank
        puts "#{loser}'s rank decreased to #{newloserrank}."
      end

    when "add"
      puts "What is the player's name?"
      playername = gets.chomp.capitalize
        if playerscores[playername.to_sym].nil?
          puts "What is their score?"
          score = gets.chomp
          playerscores[playername.to_sym] = score.to_i
          puts "#{playername} has been added with a score of #{score}."
        else
          puts "#{playername} already exists! Their score is #{playerscores[playername.to_sym]}."
        end
    when "delete"
      puts "Which player would you like to delete?"
      playername = gets.chomp.capitalize
      if playerscores[playername.to_sym].nil?
        puts "Player not found!"
      else
        playerscores.delete(playername.to_sym)
        puts "#{playername} has been removed."
      end
      
    when "update"
      puts "Would you like to update a player name or a score?"
      puts "-- 'player'"
      puts "-- 'score'"
      updatechoice = gets.chomp.downcase
      case updatechoice
        when "player"
          puts "Which player would you like to update?"
          oldname = gets.chomp.capitalize
          puts "What is their new name?"
          newname = gets.chomp.capitalize

          playerscores[newname.to_sym] = playerscores[oldname.to_sym]
          playerscores.delete(oldname.to_sym)

          puts "player #{oldname} has been updated to #{newname}, retaining score #{playerscores[newname.to_sym]}"

        when "score"
          puts "Which player would you like to update?"
          playername = gets.chomp.capitalize
          puts "What is the new score?"
          newscore = gets.chomp.capitalize
          playerscores[playername.to_sym] = newscore.to_i

          puts "#{playername}'s score has been updated to #{playerscores[playername.to_sym]}"

        else
          puts "Invalid response!"
        end
    when "kill" #to break loop during testing
      break
    else
      puts "Invalid response!"
    end
  

  
  puts "-----------------"
end
